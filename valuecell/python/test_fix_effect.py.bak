# test_fix_effect.py
import os
from agno.agent import Agent
from agno.models.openai import OpenAIChat

def test_fix_effect():
    """æµ‹è¯•ä¿®å¤æ•ˆæœ"""
    try:
        print("ğŸ§ª æµ‹è¯•ä¿®å¤æ•ˆæœ...")
        
        # ä½¿ç”¨å¯èƒ½è§¦å‘ PlannerResponse çš„é…ç½®
        model = OpenAIChat(
            id="gpt-3.5-turbo",
            base_url="https://zjuapi.com/v1",
            api_key=os.getenv("OPENAI_COMPATIBLE_API_KEY"),
            temperature=0.2,
            max_tokens=100
        )
        
        agent = Agent(
            name="Planner Test Agent",
            model=model,
            # æ·»åŠ å¯èƒ½è§¦å‘ç»“æ„åŒ–è¾“å‡ºçš„é…ç½®
            instructions="Please plan and analyze the following request carefully.",
            reasoning=True
        )
        
        response = agent.run("Plan a simple task for me")
        print(f"âœ… ä¿®å¤æµ‹è¯•æˆåŠŸ!")
        print(f"å“åº”: {response.content}")
        return True
        
    except Exception as e:
        error_msg = str(e)
        if "schema" in error_msg.lower() or "planner" in error_msg.lower():
            print(f"âŒ Schema é”™è¯¯ä»ç„¶å­˜åœ¨: {error_msg[:200]}")
            return False
        else:
            print(f"âš ï¸ å…¶ä»–é”™è¯¯ (ä½†å¯èƒ½ä¸æ˜¯ Schema é—®é¢˜): {error_msg[:200]}")
            return True

if __name__ == "__main__":
    success = test_fix_effect()
    if success:
        print("\nğŸ‰ ä¿®å¤éªŒè¯é€šè¿‡ï¼å¯ä»¥å¯åŠ¨åº”ç”¨äº†ã€‚")
    else:
        print("\nğŸ’¥ ä¿®å¤éªŒè¯å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚")